<script src="/access/js/moment.min.js"></script>
<script src="/access/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){<?php echo $this->post_script; ?>
        window.sort_table = function() {
            var defaultHeadIndex = 2;
            var defaultHeadOrder = 0;
            var $activeHead = 'table thead tr th.headerSortDown, table thead tr th.headerSortUp';
            if($($activeHead).length !== 0) {
                defaultHeadIndex = $($activeHead).index();
                defaultHeadOrder = $($activeHead).hasClass('headerSortDown') ? 0 : 1;
            }
            console.log();
            $('table.table').tablesorter({
                sortList: [[defaultHeadIndex, defaultHeadOrder]],
                textExtraction: function(node) {
                    var txt = $(node).text();
                    if($(node).hasClass('updated-at')) {
                        txt = new Date($(node).attr('origin-date')).getTime();
                    }
                    if($(node).hasClass('status')) {
                        txt = $(node).attr('status') + $(node).next("td").text().trim();
                    }
                    return txt;
                },
                headers:{
                    0: { sorter: false }
                }
            });
        };
        $.propHooks.checked = {
            set: function(elem, value, name) {
              var ret = (elem[ name ] = value);
              $(elem).trigger("change");
              return ret;
            }
        };
        $("button[name='ops']").click(function(e){
            if($(this).attr('value') === 'edit') return;
            e.preventDefault();
            $('form#opt-form')
                    .prepend($("<input>").attr("type", "hidden").attr("name", "ops").val($(this).attr('value')))
                    .submit();
        });
        $("button[value='edit']").click(function(e) {
            e.preventDefault();
            if($("input[type='checkbox'].item-checkbox:checked").first() === 0) return;
            $.ajax({
                type: "GET",
                url: "/ops/edit?<?php echo $active_type ?>="+$("input[type='checkbox'].item-checkbox:checked").first().val()+"&suppress_layout=1&continue=<?php echo $this->request->GetURI(); ?>"
            });
        });
        $("input[type='checkbox'].item-checkbox").change(function() {
            if($(this).prop('checked')) {
                $(this).parent().parent().css({"background-color": "#f7fafc"});
                $(this).parent().siblings('.item-name').addClass("item-checked-name");
                $(this).parent().parent().addClass("item-checked");
            } else {
                $(this).parent().parent().css("background-color", "transparent");
                $(this).parent().siblings('.item-name').removeClass("item-checked-name");
                $(this).parent().parent().removeClass("item-checked");
            }
        });
        window.sort_table();
    });
</script>