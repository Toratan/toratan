<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Sign up page">
        <!-- twitter bootstrap -->
        <link rel="stylesheet" href="/access/css/bootstrap.min.css">
        <link rel="stylesheet" href="/access/css/bootstrap-theme.min.css">
        <!-- jQuery -->
        <script type="text/javascript" src="/access/js/jquery-1.10.2.min.js"></script>
        <link rel="shortcut icon" href="/favicon.ico">
        <?php $this->RenderTitle();?>
        <?php $this->RenderImports(); ?>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
          <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        <style>
            html,body{margin:0px;padding:0px;height:100%;}/*Custom page header*/.header{border-bottom:1px solid #e5e5e5;}/*Custom page footer*/.footer{padding-top:1%;color:#777;border-top:1px solid #e5e5e5;clear:both;}/*Responsive : Portrait tablets and up*/@media screen and(min-width:768px){/*Remove the padding we set earlier*/.header,.tor,.footer{padding-left:0;padding-right:0;}/*Spaceout the masthead*/.header{margin-bottom:1%;}}/*iframe gen. attribs */iframe{width:100%;border-style:none;border-color:transparent;border-width:0px;}
        </style>
    </head>
    <body>
        <noscript>
            <?php \core\ui\html\alert::Cout("!!Your browser's javascript IS NOT enabled!!", \core\ui\html\alert::ALERT_DANGER); ?>
        </noscript>
        <div class="header">
            <ul class="nav nav-pills pull-right" style="padding-top: 0.25%;">
                <?php if(($user_logged = \core\db\models\user::IsSignedin())): ?>
                <li class='hidden-lg hidden-md'><a href='#'><span class='glyphicon glyphicon-flash'></span> Feeds</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="badge">2</span> Notifications<b class="caret"></b></a>
                    <ul class="dropdown-menu pull-right">
                        <li><a href="#">Some stuff</a></li>
                        <li><a href="#">Some other stuff</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <?php list($avatar_uri , $def_avatar) = \core\ui\html\avatar::get_avatar_link(\core\db\models\user::GetInstance()->user_id); ?>
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><img src='<?php echo $avatar_uri ?>' height="20" width="20" class='imageblock img-rounded' onerror="this.src='<?php echo $def_avatar ?>'"/> Account <b class="caret"></b></a>
                    <ul class="dropdown-menu pull-right">
                        <li><a href="/profile">Profile</a></li>
                        <li><a href="#">Account Settings</a></li>
                        <li class="divider"></li>
                        <li><a href="/signout">Signout</a></li>
                    </ul>
                </li>
                <?php else: ?>
                    <li><a href="/signin">Signin</a></li>
                    <li><a href="/signup">Signup</a></li>
                <?php endif; ?>
            </ul>
            <a href="/" style="font-size: x-large;" class="navbar-brand text-muted" >Toratan</a>
            <div class="clearfix"></div>
        </div>
        <div class="clearfix"></div>
        <?php require 'dialogsLayout.phtml'; ?>
        <script>
            window.active_nav = function(id) {
                $('#explorer-nav-frame').contents().find("div#exp-nav ul.nav li a[target='explorer-frame']").parent().removeClass("active");
                $('#explorer-nav-frame').contents().find("div#exp-nav ul.nav li a[target='explorer-frame']#"+id).parent().addClass("active");
            };
            window.getActiveType = function() {
                return String($('#explorer-nav-frame').contents().find("div#exp-nav ul.nav li.active").find("a").attr("id")).toLowerCase();
            };
            window.getActiveNavHtml = function() {
                var $anh = $('#explorer-nav-frame').contents().find("div#exp-nav ul.nav li.active a[target='explorer-frame']").clone();
                return $anh.removeAttr("user-data")
                        .removeAttr("target")
                            .wrap('<p/>').parent().html();
            };
            window.getActiveTypeLink = function() {
                return $('#explorer-nav-frame').contents().find("div#exp-nav ul.nav li a[target='explorer-frame']#"+window.getActiveType()).attr('href');
            };
            window.update_nav = function(auto_redirect) {
                if(typeof(auto_redirect) === "undefined") auto_redirect = false;
                try {
                    var uri = 'root';
                    var defURI = "/d/0.folders";
                    if(window.location.hash.length === 0) window.location.hash ="#!"+defURI;
                    if(window.location.hash.split('#!')[1] !== undefined) {
                        var __uri = String(window.location.hash.split('#!/')[1]).split("/");
                        if(__uri.length && __uri[0].length)
                            uri = __uri[0];
                    }
                    switch(uri.toLocaleLowerCase()) {
                        default:
                            window.location.hash ="#!"+defURI;
                        case "noteapi":
                        case "d":
                        case "root":
                        case "frame":
                            uri = 'root';
                        case "shared":
                        case "trashes":
                        case "archives":
                            if(!window.location.hash.match(/^#\!/ig)) window.location.hash = "#!"+defURI;
                            var target = window.location.hash.split('#!')[1];
                            if(target.length === 0 || target === "/")
                                target = defURI;
                            window.active_nav(uri);
                            if(auto_redirect)
                                window.document.getElementById('explorer-frame').src = target;
                            break;
                    }
                } catch(e) {
                    window.open_errorModal("<span class='glyphicon glyphicon-remove'></span> "+e);
                }
            };
        </script>
        <div class="container-fluid" style="padding-top:0.5%">
        <?php if($user_logged) :  ?>
            <iframe id="explorer-nav-frame" name="explorer-nav-frame" frameborder="0" style="height: 250px" src="/frame/en" class="pull-left col-lg-2 col-md-2 col-sm-3 col-xm-3"></iframe>
            <iframe id="explorer-frame" name="explorer-frame" frameborder="0" style="height: 768px" src="" class="col-lg-7 col-md-7 col-sm-9 col-xm-9"></iframe>
            <iframe id="feed-frame" name="feed-frame" frameborder="0" style="height: 768px" src="/frame/f" class="pull-right col-lg-3 col-md-3 hidden-sm hidden-xs"></iframe>
        <?php else: ?>
            <legend>Not logged in {Fames go here!!}</legend>
            <iframe id="explorer-frame" name="explorer-frame" frameborder="0" style="height: 768px" src="" class="col-lg-12 col-md-12 col-sm-12 col-xm-12"></iframe>
            <script type="text/javascript">
                (function(){
                    window.update_nav(true);
                });
            </script>
        <?php endif; ?>
        </div>
        <script type="text/javascript" src="/access/js/bootstrap.min.js"></script>
        <script type="text/javascript">
            (function(){
                // modify frames' size on window resize event
                $(window).resize(function() {
                    var $frames = $('iframe#explorer-frame, iframe#feed-frame');
                    if($(window).height() >= 420)
                        // re-size the frames
                        $frames.css('height', ($(window).height() - 90)+'px');
                    else
                        $frames.css('height', '768px');
                });
                // init frames' size to window's size
                $(window).resize();
                // re-locate the explorer
                $('#explorer-nav-frame').attr('src', '/frame/en/'+window.location.hash);
            })(jQuery);
        </script>
    </body>
</html>