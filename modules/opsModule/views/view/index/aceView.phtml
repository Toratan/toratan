<?php
    $title = "Your note's title here ...";
    $body = "Your note's body here ...";
    if($this->edit)
    {
        $title = $this->values['note_title'];
        $body = $this->values['note_body'];
    }
    $value= "##$title##\r\n$body";
    $this->layout->setlayout("ace");
?>
<style type="text/css" media="screen">
    #editor-container, 
    #editor { position: fixed; top: 10px; right: 0; bottom: 10px; left: 10px; width: 50%;height: 92%; margin-top: 55px; padding: 10px; border: 1px solid #000}
    #editor-container {top:0; left:0; width: 55%; height: 100%}
</style>
<script>
        $(document).ready(function()
        {
            //$(window).bind('beforeunload', function(e){
               // return "Preventing data loss!";
            //});
            window.editor = ace.edit("editor");
            window.editor.setTheme("ace/theme/twilight");
            window.editor.getSession().setMode("ace/mode/markdown");
            window.editor.getSession().setTabSize(4);
            window.editor.commands.addCommand({
                name: 'save',
                bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},
                exec: save
            });
            window.editor.commands.addCommand({
                name: 'alert',
                bindKey: {win: 'Ctrl-A',  mac: 'Command-A'},
                exec: function(editor)
                {
                    alert(editor.getValue());
                }
            });
            window.editor.focus();
            window.editor.navigateFileEnd();
            window.editor.resize();
            $("div#editor").show();
        });
        function save(editor) 
        {
            $(window).unbind('beforeunload');
            $("form[name='note'] input[name='note_title']").val($("#editor-title").val());
            $("form[name='note'] textarea[name='note_body']").html(editor.getValue());
            $("form[name='note'] input[name='version']").val("ace");
            $("form[name='note']").submit();
        }        
</script>
<!-- ace aditor placeholder -->
<div id="editor-container" class="container-fluid">
    <div id="editor" class="container-fluid" style="padding-top:0.5%;display: none;"><?php echo htmlspecialchars($value) ?></div>
</div>
<script src="/access/rte/ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<form action="<?php echo $this->request->getURI(); ?>" method="POST" name='note' style="display: none;">
    <input type="hidden" name="version" value="html" />
    <input type="text" name="note_title" maxlength="250" value="<?php echo isset($this->values['note_title'])?$this->values['note_title']:"" ?>" required="required"/><br />
    <textarea rows="10" cols="80" name="note_body" ><?php echo isset($this->values['note_body'])?$this->values['note_body']:"" ?></textarea>
    <input type="submit" value="Create" />
</form>
