<?php
    $title = "Your note's title here ...";
    $body = "Your note's body here ...";
    if($this->edit)
    {
        $title = $this->values['note_title'];
        $body = $this->values['note_body'];
    }
?>
<script src="/access/rte/ckeditor/ckeditor.js"></script>
<script src="/access/rte/ckeditor/adapters/jquery.js"></script>
<script>
        $( document ).ready( function() {
            $(window).bind('beforeunload', function(e){
                return "Preventing data loss!";
            });
            $editor = $( 'textarea#editor-platform' ).ckeditor();
            $('ul.nav li a#setting-flip-flop').click(function($e){
                if($('div#editor').css("display") === "none")
                    $('ul.nav li a#setting-flip-flop span#setting-flip-flop-name').html("Settings");
                else
                    $('ul.nav li a#setting-flip-flop span#setting-flip-flop-name').html("Editor");
                $('div#editor').slideToggle();
                $('div#setting-bar').slideToggle();
                $e.preventDefault();
            });
            $("a#switch-editor").click(function(e) {
                $(window).unbind('beforeunload');
                e.preventDefault();
                var href = String($(this).attr('href')).substr(1); // remove first `#` char. 
                if(false && !anything_changed()) { window.location = href; return;}
                $("form[name='note']")
                        .append('<input type="hidden" name="submit-type" value="change-editor" />')
                        .append('<input type="hidden" name="pid" value="<?php echo $this->pid ?>" />')
                        .attr('action', href)
                        .submit();
            });
        } );
</script>

<noscript>
    <?php \core\ui\html\alert::Cout("Your browser javascript is not enabled, the <b>html version</b> has been loaded!!", \core\ui\html\alert::ALERT_DANGER); ?>
</noscript>
<!-- Sidebar placeholder -->
<ul class="nav nav-pills pull-right inline">
    <li>
        <a href="#" id="setting-flip-flop"><span id="setting-flip-flop-name">Settings</span> <span class="caret"></span></a>
    </li>
</ul>
<div class="clearfix visible-xs"></div>
<div id="setting-bar" class="" style="width: 80%;padding: 0%;display: none/**/">
    <table class="table-bordered table-responsive" style="margin:1%;margin-left:1.7%">
        <tbody>
            <tr>
                <td>
                    <ul class="nav nav-pills">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <span class="glyphicon glyphicon-list-alt"></span>
                                <span class="badge"> 2</span> Text Editor [<span id="rte-type">Classic</span>] <b class="caret"></b></a>
                                <ul class="dropdown-menu pull-left">
                                    <li><a href="#/change/editor/to/ace?continue=<?php echo urlencode($this->request->getURI()); ?>" id="switch-editor"><span class="glyphicon glyphicon-credit-card"></span> Ace editor</a></li>
                                    <li class='active'><a href="#">Classic</a></li>
                                </ul>
                        </li>
                    </ul>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div class="clearfix visible-xs"></div>
<div id="editor" class="" style="margin:0">
    <form action="<?php echo $this->request->getURI(); ?>" method="POST" name='note'>
        <input type="hidden" name="version" value="html" />
        <input type="text" style="width: 80%;float: left" name="note_title" maxlength="250" class="form-control" value="<?php echo $title ?>" required="required"/><br />
        <div class="clearfix" style="margin: 1%"></div>
        <textarea class="ckeditor form-control" id="editor-platform" rows="10" tabindex="1" name="note_body" style="width: 100%"><?php
            # invoke the markdown initiliazer
            $mdi = new \core\ui\markdown\markdownInitiliazer;
            # execute the initliazer
            $mdi->Execute();
            # markdown the context
            echo \Markdown($body);
        ?></textarea>
        <div class="col-lg-1 pull-right" style="margin:0;padding:0;margin-top: 1%;width: 8%">
            <small class="pull-right" style="margin: 0"><a class="btn btn-warning btn-small" href="/d/<?php echo $this->pid ?>.notes">Cancel</a></small>
            <input type="submit" value="Done" class="btn btn-primary btn-small apull-left" onclick="$(window).unbind('beforeunload');"/>
        </div>
    </form>
</div>
