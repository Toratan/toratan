<?php if(!@$this->profile) throw new \zinux\kernel\exceptions\invalideArgumentException("Not profile instance provided...."); ?>
<?php $is_profile_owner = (@\core\db\models\user::GetInstance()->user_id == $this->profile->user_id); ?>
<style type='text/css'>
    table tr td[rowspan]{width: 1%}
</style>
<legend class='text-muted'>Profile Details
    <?php if(\core\db\models\user::IsSignedin() && \core\db\models\user::GetInstance()->user_id != $this->profile->user_id):  ?>
    <span class='pull-right' style='font-size: medium'>
        <a href='/subscribe/<?php 
            echo "{$this->profile->user_id}?".(\zinux\kernel\security\security::GetHashString(array($this->profile->user_id, session_id()."subscribe"))); 
        ?>'>Follow</a> | <a href='/messages/new/<?php 
            echo "{$this->profile->user_id}?".(\zinux\kernel\security\security::GetHashString(array($this->profile->user_id, session_id()."message"))); 
        ?>'>Send Message</a></span>
    <?php endif; ?>
</legend>
<div class='visible-sm visible-xs' style='margin: 1%;'></div>
<link rel="stylesheet" href="/access/css/mosaic.css" type="text/css" media="screen">
<style>
    @media screen and (min-width: 300px) { .mosaic-block{min-width: 200px;display: block;min-height: 200px;}}
    @media screen and (min-width: 600px) { .table{width: 100%; float: none;} }
    @media screen and (min-width: 700px) { .table{width: 69%; float: right} }
    @media screen and (min-width: 1000px) { .table{width: 77%} }
    @media screen and (min-width: 1200px) { .table{width: 80%} }
    .mosaic-block{background: #000 url('/access/img/progress.gif') no-repeat center <?php echo $is_profile_owner?"40%":"50%" ?>;}
</style>
<?php
    list($avatar_uri , $def_avatar) = \core\ui\html\avatar::get_avatar_link($this->profile->user_id);
?>
<div class="mosaic-block bottom-bar">
<?php if($is_profile_owner) : ?>
    <a href="/profile/avatar"  class="mosaic-overlay" style="display: inline; left: 0px; bottom: -50px;">
        <div class="details text-center ">
            <h1>Change your avatar <span class="glyphicon glyphicon-picture"></span></h1>
        </div>
    </a>
<?php endif ; ?>
    <img id="thumbnail" width="200" height="200" class='img-responsive img-thumbnail' src="<?php echo $avatar_uri ?>" onerror="this.src='<?php echo $def_avatar ?>';"/>
</div>
<?php if(!$this->profile->getSetting("/profile/status")) : ?>
<div class='clearfix visible-xs'></div>
<div class='table'>
    <?php \core\ui\html\alert::Cout("No profile provided by user!", \core\ui\html\alert::ALERT_DANGER, 0); ?>
</div>
<?php return ; endif; ?>
<table class="table table-responsive" >
    <tbody>
        <tr>
            <td style='width: 30%'>Name</td>
            <td>
                <span class='' style=''><?php echo "{$this->profile->first_name} {$this->profile->last_name}"?></span>
                <?php if(!empty($this->profile->nick_name)): ?>(<abbr title='Also Known As'><?php echo $this->profile->nick_name ?></abbr>)<?php endif; ?>
            </td>
            <?php if($is_profile_owner): ?><td rowspan="3"><a href='/profile/edit/step/1' class='pull-right' >Edit</a></td><?php endif; ?>
        </tr>
        <tr>
            <td>Birthday</td>
            <td><?php echo \date("M d Y", \mktime(0,0,0, $this->profile->birth_month, $this->profile->birth_day, $this->profile->birth_year))?></td>
        </tr>
        <tr>
            <td>Gender</td>
            <td><?php echo $this->profile->is_male?"Male":"Female"?></td>
        </tr>
        <tr>
            <td>Location</td>
            <td><?php 
                if(!\strlen($this->profile->city) && !\strlen($this->profile->country))
                    echo "<span class='glyphicon glyphicon-question-sign'></span> Unknown";
                else
                    echo $this->profile->city.(strlen($this->profile->country )?(strlen($this->profile->city)?", ":"")."{$this->profile->country}":"");
            ?></td>
            <?php $rowspan = 1; foreach(array("edu", "intro", "occu") as $value) if(!\strlen($value)) $rowspan++; ?>
            <?php if($is_profile_owner): ?><td rowspan="<?php echo $rowspan; ?>"><a href='/profile/edit/step/2' class='pull-right' >Edit</a></td><?php endif; ?>
        </tr>
        <?php if(\strlen($this->profile->edu)) : ?>
        <tr>
            <td>Educations</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->edu ?></blockquote></td>
        </tr>
        <?php endif; if(\strlen($this->profile->intro)) : ?>
        <tr>
            <td>Introduction</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->intro ?></blockquote></td>
        </tr>
        <?php endif; if(\strlen($this->profile->occu)) : ?>
        <tr>
            <td>Occupations</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->occu ?></blockquote></td>
        </tr>
        <?php endif; ?>
        <?php 
            $contact_edit_imported = 0;
            $rowspan = 0; 
            foreach(array("edu", "intro", "occu") as $value) if(!\strlen($value)) $rowspan++; 
            $contact_edit = $is_profile_owner?'<td rowspan="'.$rowspan.'"><a href="/profile/edit/step/3" class="pull-right" >Edit</a></td>':""; 
            ?>
        <?php if(\strlen($this->profile->public_email)) : ?>
        <tr>
            <td>Email</td>
            <td>
                <?php foreach(\explode(";", $this->profile->public_email) as $email) : ?>
                <a href='mailto:<?php echo $email ?>' target="__blank"><?php echo $email ?></a><br />
                <?php endforeach; ?>
            </td>
            <?php echo !$contact_edit_imported?$contact_edit:"";$contact_edit_imported =1?>
        </tr>
        <?php endif; if(\strlen($this->profile->phone)) : ?>
        <tr>
            <td>Phone#</td>
            <td>
                <?php foreach(\explode(";", $this->profile->phone) as $phone) : ?>
                <a><?php echo $phone ?></a><br />
                <?php endforeach; ?>
            </td>
            <?php echo !$contact_edit_imported?$contact_edit:"";$contact_edit_imported =1?>
        </tr>
        <?php endif; if(\strlen($this->profile->site)) : ?>
        <tr>
            <td>Sites</td>
            <td>
                <?php foreach(\explode(";", $this->profile->site) as $site) : ?>
                <a href='<?php echo (\preg_match("#^http(s)?//.*#i", $site)?"":"http://").$site ?>' target="__blank"><?php echo \preg_replace("#^(http(s)?//)#i", "", $site); ?></a><br />
                <?php endforeach; ?>
            </td>
            <?php echo !$contact_edit_imported?$contact_edit:"";$contact_edit_imported =1?>
        </tr>
        <?php endif; if(!$contact_edit_imported && $is_profile_owner): ?>
        <tr class='text-center'>
            <td colspan="3">No Contact Information, you can always add some contact information <a href="/profile/edit/step/3">here</a>.</td>
        </tr>
        <?php endif; ?>
    </tbody>
</table>