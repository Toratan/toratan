<?php if(!@$this->profile) throw new \zinux\kernel\exceptions\invalideArgumentException("Not profile instance provided...."); ?>
<?php if(!$this->profile->getSetting("/profile/status")) return \core\ui\html\alert::Cout("No profile provided by user!", \core\ui\html\alert::ALERT_DANGER, 0); ?>
<style type='text/css'>
    table tr td[rowspan]{width: 1%}
</style>
<?php 
/**
 * Get either a Gravatar URL or complete image tag for a specified email address.
 *
 * @param string $email The email address
 * @param string $s Size in pixels, defaults to 80px [ 1 - 2048 ]
 * @param string $d Default imageset to use [ 404 | mm | identicon | monsterid | wavatar ]
 * @param string $r Maximum rating (inclusive) [ g | pg | r | x ]
 * @param boole $img True to return a complete IMG tag False for just the URL
 * @param array $atts Optional, additional key/value attributes to include in the IMG tag
 * @return String containing either just a URL or a complete image tag
 * @source http://gravatar.com/site/implement/images/php/
 */
function get_gravatar( $email, $s = 80, $d = 'mm', $r = 'g', $img = false, $atts = array() ) {
    $url = 'http://www.gravatar.com/avatar/';
    $url .= md5( strtolower( trim( $email ) ) );
    $url .= "?s=$s&d=$d&r=$r";
    if ( $img ) {
        $url = '<img src="' . $url . '"';
        foreach ( $atts as $key => $val )
            $url .= ' ' . $key . '="' . $val . '"';
        $url .= ' />';
    }
}
?>
<legend class='text-muted'>Profile Details
    <?php if(\core\db\models\user::IsSignedin() && \core\db\models\user::GetInstance()->user_id != $this->profile->user_id):  ?>
    <span class='pull-right' style='font-size: medium'>
        <a href='/subscribe/<?php 
            echo "{$this->profile->user_id}?".(\zinux\kernel\security\security::GetHashString(array($this->profile->user_id, session_id()."subscribe"))); 
        ?>'>Follow</a> | <a href='/messages/new/<?php 
            echo "{$this->profile->user_id}?".(\zinux\kernel\security\security::GetHashString(array($this->profile->user_id, session_id()."message"))); 
        ?>'>Send Message</a></span>
    <?php endif; ?>
</legend>
<div class='visible-sm visible-xs' style='margin: 1%;'></div>
<style>
    @media screen and (min-width: 300px) { .thumbnail{display:block;width: 50%}}
    @media screen and (min-width: 400px) { .table{width: 77%} .thumbnail{width: 19%}}
    @media screen and (min-width: 1200px) { .table{width: 80%} .thumbnail{width: 17%}}
</style>
<div class='pull-left thumbnail'>
    <img class='img-thumbnail' alt='<?php echo $this->profile->first_name." ".$this->profile->last_name ?>' title='<?php echo $this->profile->first_name." ".$this->profile->last_name ?>' onerror="this.src='/access/img/anonymous-<?php echo $this->profile->is_male?"male":"female"; ?>.jpg';" src='<?php \core\ui\html\avatar::fetch_uri(\core\ui\html\avatar::GRAVATAR, \core\db\models\user::Fetch($this->profile->user_id)->email."a", \core\ui\html\avatar::LARGE_SIZE)?>'/>
</div>
<table class="table table-responsive pull-right" >
    <tbody>
        <tr>
            <td style='width: 30%'>Name</td>
            <td>
                <span class='' style=''><?php echo "{$this->profile->first_name} {$this->profile->last_name}"?></span>
                (<abbr title='Also Known As'><?php echo $this->profile->nick_name ?></abbr>)
            </td>
            <td rowspan="3"><a href='/profile/edit/step/1' class='pull-right' >Edit</a></td>
        </tr>
        <tr>
            <td>Birthday</td>
            <td><?php echo \date("M d Y", \mktime(0,0,0, $this->profile->birth_month, $this->profile->birth_day, $this->profile->birth_year))?></td>
        </tr>
        <tr>
            <td>Gender</td>
            <td><?php echo $this->profile->is_male?"Male":"Female"?></td>
        </tr>
        <tr>
            <td>Location</td>
            <td><?php 
                if(!\strlen($this->profile->city) && !\strlen($this->profile->country))
                    echo "<span class='glyphicon glyphicon-question-sign'></span> Unknown";
                else
                    echo $this->profile->city.(strlen($this->profile->country )?(strlen($this->profile->city)?", ":"")."{$this->profile->country}":"");
            ?></td>
            <td rowspan="4"><a href='/profile/edit/step/2' class='pull-right' >Edit</a></td>
        </tr>
        <tr>
            <td>Educations</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->edu?></blockquote></td>
        </tr>
        <tr>
            <td>Introduction</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->intro?></blockquote></td>
        </tr>
        <tr>
            <td>Occupations</td>
            <td style='text-align: justify'><blockquote><?php echo $this->profile->occu;?></blockquote></td>
        </tr>
        <tr>
            <td>Email</td>
            <td>
                <?php foreach(\explode(";", $this->profile->public_email) as $email) : ?>
                <a href='mailto:<?php echo $email ?>' target="__blank"><?php echo $email ?></a><br />
                <?php endforeach; ?>
            <td rowspan="3"><a href='/profile/edit/step/3' class='pull-right' >Edit</a></td>
            </td>
        </tr>
        <tr>
            <td>Phone#</td>
            <td>
                <?php foreach(\explode(";", $this->profile->phone) as $phone) : ?>
                <a><?php echo $phone ?></a><br />
                <?php endforeach; ?>
            </td>
        </tr>
        <tr>
            <td>Sites</td>
            <td>
                <?php foreach(\explode(";", $this->profile->site) as $site) : ?>
                <a href='<?php echo (\preg_match("#^http(s)?//.*#i", $site)?"":"http://").$site ?>' target="__blank"><?php echo \preg_replace("#^(http(s)?//)#i", "", $site); ?></a><br />
                <?php endforeach; ?>
            </td>
        </tr>
    </tbody>
</table>